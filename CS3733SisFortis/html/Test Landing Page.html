
<!-- //#1: when highlighted row has a checkmark, the button says "unmark complete" and vice versa
     //#2: modify the lambda to make it so that it pulls the task from the table, determines its status, and marks it the opposite. -->

<html>
    <style>
        body{
            font-family: Arial, Helvetica, sans-serif;
            background-color: rgb(160, 160, 160);
        }
        .centered {
            position: absolute;
            left: 50%;
            transform: translate(-50%, 0);
            text-align: center;
        }
        .button{
            text-align: center;
            font-size: 18px;
            cursor: pointer;
            -webkit-transition-duration: 0.4s; /* Safari */
            transition-duration: 0.4s;
        }
        .button:hover {
            box-shadow: 0 12px 16px 0 rgba(0,0,0,0.24),0 17px 50px 0 rgba(0,0,0,0.19);
        }
        .split{
            position: fixed;
            z-index: 1;
            overflow-x: hidden;
            height: 100%;
            top: 0;
            background-color: rgb(158, 158, 158);
        }
        .left {
            left: 0;
            width: 70%;
            /* background-color: rgb(158, 158, 158); */
        }
    
        .right {
            right: 0;
            width: 30%;
            /* background-color: rgb(255, 255, 255); */
        }
        .box{
            position: absolute;
            width: 95%;
            height: 85%;
            margin-top: 100;
            /* padding: 50px; */
            /* border: 2px solid rgb(0, 0, 0);   */
            box-shadow: 1px 2px 10px #000000;
            background-color: rgb(255, 255, 255);
        }
    
        .header{
            font-size: 40px;
            font-family: Arial, Helvetica, sans-serif;
            font-weight: 500;
        }
        .arrowButton {
            background-color: transparent; /* Green */
            border: none;
            color: rgb(0, 0, 0);
            text-align: center;
            font-size: 80px;
            cursor: pointer;
        }
        .button{
            text-align: center;
            font-size: 18px;
            cursor: pointer;
            -webkit-transition-duration: 0.4s; /* Safari */
            transition-duration: 0.4s;
        }
        .button:hover {
            box-shadow: 0 12px 16px 0 rgba(0,0,0,0.24),0 17px 50px 0 rgba(0,0,0,0.19);
        }
        .outline{
            position: absolute;
            left: 5px;
            top: 5px;
            font-size: 18px;
            /* transform: translate(-50%, 0); */
            text-align: left;
        }
    
    </style>

    <script type="text/javascript">
    
        //General API URL
        var APIURL = "https://wngyuz3a1h.execute-api.us-east-2.amazonaws.com/Alpha/";
        
        //URL for each resource of the API
        var createProjectURL = APIURL + "createProject";
        var listProjectsURL = APIURL + "listProjects";
        var projectViewURL = APIURL + "projectView";
        var deleteProjectURL = APIURL + "deleteProject";
        var addTaskURL = APIURL + "addTasks";
        var addTeammateURL = APIURL + "addTeammate";
        var removeTeammateURL = APIURL + "removeTeammate";
        var archiveProjectURL = APIURL + "archiveProject";
        var markTaskCompletedURL = APIURL + "markTask";
        var assignTeammateURL = APIURL + "assignTeammate";
        var unassignTeammateURL = APIURL + "unassignTeammate";
        var subdivideTaskURL = APIURL + "decomposeTask"


        //Variables to allow hiding/unhiding of each webpage
        var LandingPage = true;
        var AdminPage = false;
        var UserPage = false;

        //To keep track of which row is highlighted
        var highlightedRow = 1;
        var lastHighlightedRow = 1;

        //Vars to keep display data for project stored so it doesnt need to be regenerated each time user switches between project view and team view.
        var teamViewDisplayData = "teamViewPlaceHolderData";
        var projectViewDisplayData = "projectViewPlaceHolderData";

        //To make the green check marks
        var checkMark = "âœ…";

        //To hold value of whether a project is archived.
        var currentlyOpenProjectArchived = false;


        //GENERAL USE FUNCTIONS ---------------------------------------------------------
        
        //Increments the highlighted row up one
        function upArrowButtonPress(){
            if(document.getElementById(highlightedRow) == null){//If the highlighted row doesnt exist, reset to row 1
                highlightedRow = 1;
                lastHighlightedRow = 1;
                updateHighlightedRow();
                return;
            }
            if(document.getElementById(highlightedRow - 1) == null){
                return;
            }

            lastHighlightedRow = highlightedRow;
            highlightedRow = highlightedRow - 1;
            updateHighlightedRow();
            // document.getElementById("testP").innerHTML = highlightedRow;
        }

        //Increments the highlighted row down one
        function downArrowButtonPress(){
            if(document.getElementById(highlightedRow) == null){//If the highlighted row doesnt exist, reset to row 1
                highlightedRow = 1;
                lastHighlightedRow = 1;
                updateHighlightedRow();
                return;
            }
            if(document.getElementById(highlightedRow + 1) == null){
                return;
            }
            lastHighlightedRow = highlightedRow;
            highlightedRow = highlightedRow + 1;
            updateHighlightedRow();
            // document.getElementById("testP").innerHTML = highlightedRow;
        }

        //Unhighlights previously selected row, and highlights newly selected row. 
        function updateHighlightedRow(){
            try{
                document.getElementById(lastHighlightedRow).innerHTML
                document.getElementById(highlightedRow).innerHTML
            }catch{
                highlightedRow = 1;
                lastHighlightedRow = 1;
            }
            document.getElementsByName(lastHighlightedRow).forEach(e => e.style.backgroundColor = "white");
            document.getElementsByName(highlightedRow).forEach(e => e.style.backgroundColor = "yellow");

            try{
                //Set the mark task button to unmark task when needed
                var highlightedRowText = document.getElementById(highlightedRow).innerHTML;
                
                if(highlightedRowText.indexOf(checkMark) == -1){
                    document.getElementById("MarkSelectedTaskButton").value = "Mark Selected Task Complete"                
                }else{
                    document.getElementById("MarkSelectedTaskButton").value = "Mark Selected Task Incomplete"
                }
            }catch{
                
            }


        }

        function writeToDisplayBox(str){
            var elements = document.getElementsByName("AdminProjectDisplayBox");
            elements.forEach(element => element.innerHTML = str);
            updateHighlightedRow();
        }

        //ADMIN PAGE FUNCTIONS ---------------------------------------------------------

        function deleteProjectButtonPress(e){
            console.log("Deleting project");
            var projectName = document.getElementById(highlightedRow).innerHTML;
            projectName = projectName.substring(0,projectName.lastIndexOf(" "));
            // projectName = projectName.substr(projectName.indexOf(" "));


            

            var data = {};
            data["projectName"] = projectName;


            var js = JSON.stringify(data);
            console.log("JS:" + js);
            var xhr = new XMLHttpRequest();
            xhr.open("POST", deleteProjectURL, true);

            //Send the data as JSON
            xhr.send(js);

            document.getElementById("AdminPageNotification").innerHTML = "Working on deleting project...";

            //Process result
            xhr.onloadend = function (){
                console.log(xhr);
                console.log(xhr.request);
                if (xhr.readyState == XMLHttpRequest.DONE){
                    if(xhr.status == 200){
                        console.log("XHR:" + xhr.responseText);
                        processDeleteProjectResponse(xhr.responseText);
                    }else if(xhr.status == 400){
                        alert("Unable to process request");
                    }
                }else{
                    processDeleteProjectResponse("N/A");
                }
            };
        }

        //Print the created project name to screen
        function processDeleteProjectResponse(result){
            console.log("result:" + result);
            var js = JSON.parse(result);
            if(result != "N/A"){
                getProjectList();
                document.getElementById("AdminPageNotification").innerHTML = "Successfully deleted project: " + js["projectName"];
                highlightedRow = 1;
                lastHighlightedRow = 1;
            }else{
                document.getElementById("AdminPageNotification").innerHTML = "Could not delete project";
            }
            
        }
        

        

        function archiveProjectButtonPress(e){
            console.log("Archiving project");
            var projectName = document.getElementById(highlightedRow).innerHTML;
            projectName = projectName.substr(0,projectName.lastIndexOf(" "));


            

            var data = {};
            data["projectName"] = projectName;


            var js = JSON.stringify(data);
            console.log("JS:" + js);
            var xhr = new XMLHttpRequest();
            xhr.open("POST", archiveProjectURL, true);

            //Send the data as JSON
            xhr.send(js);

            document.getElementById("AdminPageNotification").innerHTML = "Working on archiving project...";

            //Process result
            xhr.onloadend = function (){
                console.log(xhr);
                console.log(xhr.request);
                if (xhr.readyState == XMLHttpRequest.DONE){
                    if(xhr.status == 200){
                        console.log("XHR:" + xhr.responseText);
                        processArchiveProjectResponse(xhr.responseText);
                    }else if(xhr.status == 400){
                        alert("Unable to process request");
                    }
                }else{
                    processArchiveProjectResponse("N/A");
                }
            };
        }

        //Print the created project name to screen
        function processArchiveProjectResponse(result){
            console.log("result:" + result);
            var js = JSON.parse(result);
            if(result != "N/A"){
                getProjectList();
                document.getElementById("AdminPageNotification").innerHTML = "Successfully Archived project: " + js["projectName"];
                highlightedRow = 1;
                lastHighlightedRow = 1;
                updateHighlightedRow();
            }else{
                document.getElementById("AdminPageNotification").innerHTML = "Could not archive project";
            }
        }
        


        //LANDING PAGE FUNCTIONS ---------------------------------------------------------
        
        //Runs when admin button is pressed
        //Switches to Admin View, Gets all the projects, and lists them.
        function adminButtonPress(){
            var form = document.testForm;
            var textVal = form.textBox.value;

            getProjectList();

            document.getElementById("LandingPage").hidden = true;
            document.getElementById("AdminPage").hidden = false;
            document.getElementById("UserPage").hidden = true;
        }

        //GET request for listProjects
        function getProjectList(){
            var data = {};

            var xhr = new XMLHttpRequest();
            xhr.open("GET", listProjectsURL, true);

            //Send the data as JSON
            xhr.send();

            // document.getElementById("AdminProjectDisplayBox").innerHTML = "Loading Project Data from Database...";
            writeToDisplayBox("Loading Project Data from Database...");

            //Process result
            xhr.onloadend = function (){
                console.log(xhr);
                console.log(xhr.request);
                if (xhr.readyState == XMLHttpRequest.DONE){
                    if(xhr.status == 200){
                        console.log("XHR:" + xhr.responseText);
                        processListProjectsResponse(xhr.responseText);
                    }else if(xhr.status == 400){
                        alert("Unable to process request");
                    }
                }else{
                    processListProjectsResponse("N/A");
                }
                updateHighlightedRow();
            };
        }

        //Processes data from the listProjects GET request
        function processListProjectsResponse(result){
            console.log("result:" + result);
            var js = JSON.parse(result);

            projectList = js["projects"];

            
            console.log("projects: " + projectList);
            console.log(projectList[0].name);
            console.log(projectList[0].archived);
            var str = "";
            var rowNum = 1;
            var t = "&emsp;&emsp;";
            var style = " style=\"color:blue;\" ";
            // project = js["project"];
            // projectName = project["name"];
            // tasks = project["tasks"];

            projectList.forEach(project => {

               if(project.archived) {
                style = " style=\"color:blue;\" "; 
                
               }   
               else{ 
                style = " style=\"color:black;\" "; 
               }
               
                
                //Determine status metricics for the tasks in the project.
                try{
                    tasks = project["tasks"];
                    var numTasks = 0;
                    var numTasksComplete = 0;
                    tasks.forEach(task =>{
                        if(task.status){
                            numTasksComplete++;
                        }
                        numTasks++;
                    })
                }catch{
                    console.log("No tasks for this project")
                }
                if(numTasks != 0){
                    statusMetric = ((numTasksComplete/numTasks)*100).toFixed(); //toFixed(numDecimals) sets value to zero decmial places
                }else{
                    statusMetric = 0;
                }

                //str =  str + '\n' + "<div name=\"" + rowNum + "\" id=\"" + rowNum + "\"" + style + ">" + project.name + "</div>";     
              
                //Create display string for projects
                str =  str + '\n' + "<div name=\"" + rowNum + "\" id=\"" + rowNum + "\"" + style +  ">" + project.name + " " + statusMetric +"%</div>";
                rowNum = rowNum + 1;


                try{
                    teammates = project["teammates"];
                    teammates.forEach(teammate => {
                        str =  str + '\n' + "<div"+ style + " >" + t + teammate.name + "</div>";
                    })
                }catch{
                    console.log("Error parsing teammates for project");
                }

            });
        
            // str = "No Projects Stored in Database"
            

            
            console.log(str);
            // document.getElementById("AdminProjectDisplayBox").innerHTML = str;
            writeToDisplayBox(str);
            updateHighlightedRow();
        }

        //Runs when open project button is pressed
        //Switches to task view for the entered project
        function openProjectButtonPress(){
            var form = document.testForm;
            var textVal = form.textBox.value;

            openProject();
        }

        //POST Request for opening a project. ALso to be used to update display when in the Project View or Team View.
        function openProject(){
            var form = document.testForm;
            var textVal = form.textBox.value;

            var data = {};
            data["projectName"] = textVal;


            var js = JSON.stringify(data);
            console.log("JS:" + js);
            var xhr = new XMLHttpRequest();
            xhr.open("POST", projectViewURL, true);


            document.getElementById("LandingPageNotification").innerHTML = "Loading project...";

            //Send the data as JSON
            xhr.send(js);
    
            

            //Process result
            xhr.onloadend = function (){
                console.log(xhr);
                console.log(xhr.request);
                if (xhr.readyState == XMLHttpRequest.DONE){
                    if(xhr.status == 200){
                        console.log("XHR:" + xhr.responseText);
                        processProjectViewResponse(xhr.responseText);
                    }else if(xhr.status == 400){
                        alert("Unable to process request");
                    }
                }else{
                    processProjectViewResponse("N/A");
                }
            };
        }


        //Makes sure display is switched to Team/Project view, and updates the display
        function processProjectViewResponse(result){
            var form = document.testForm;
            var textVal = form.textBox.value;

            // console.log("result:" + result);
            var js = JSON.parse(result);


            try {
                project = js["project"];
                projectName = project["name"];
                currentlyOpenProjectArchived = project["archived"];
                enableDisableProjectButtons(currentlyOpenProjectArchived);
                document.getElementById("ProjectNameHeader").innerHTML = projectName + " Team View";
                document.getElementById("ProjectViewHeader").innerHTML = projectName + " Project View";
                document.getElementById("LandingPageNotification").innerHTML = "";//Remove previous text from landing page notification
                document.getElementById("LandingPage").hidden = true;
                document.getElementById("AdminPage").hidden = true;
                document.getElementById("UserPage").hidden = false;
                displayProjectInfo(result); //Update display box
            } catch (error) {
                document.getElementById("LandingPageNotification").innerHTML = "Could not find project: " + textVal;
                document.getElementById("LandingPage").hidden = false;
                document.getElementById("AdminPage").hidden = true;
                document.getElementById("UserPage").hidden = true;
            }
        }

        function enableDisableProjectButtons(disable){
            document.getElementById("AddTaskButton").disabled = disable;
            document.getElementById("AddSubtaskButton").disabled = disable;
            document.getElementById("AssignTeammateButton").disabled = disable;
            document.getElementById("UnassignTeammateButton").disabled = disable;
            document.getElementById("MarkSelectedTaskButton").disabled = disable;

            document.getElementById("AddTeammateButton").disabled = disable;
            document.getElementById("RemoveTeammateButton").disabled = disable;

            if(disable){
                document.getElementById("ProjectViewNotification").innerHTML = "This Project is Archived."
                document.getElementById("TeamViewNotification").innerHTML = "This Project is Archived." 
            }
        }

        function displayProjectInfo(result){
            if(result == "N/A"){return;} //Return if didnt get anything useful
            // console.log("result:" + result);
            var js = JSON.parse(result);

            try {
                project = js["project"];
                projectName = project["name"];
                tasks = project["tasks"];
                teammates = project["teammates"];
            } catch (error) {
                console.log("Could not find project and tasks in response");
            }

            // console.log(document.getElementById("ProjectView").hidden)
            //Parse the list of tasks
            try{
                generateProjectViewText(tasks); //Generate the text, then display the correct one.
                generateTeamViewText(teammates);
                if(document.getElementById("ProjectView").hidden){//If project view is hidden then display in the TEAM VIEW
                    writeToDisplayBox(teamViewDisplayData);
                }
                if(document.getElementById("TeamView").hidden){//If team view is hidden then display in PROJECT VIEW
                    writeToDisplayBox(projectViewDisplayData);
                }
            }catch{
                console.log("Could not parse tasks");
            }

            try{
                updateTeammateSelectOptions(teammates);
            }catch{
                console.log("Could not update teammate dropdown.")
            }
        }


        function generateTaskString(task, rowNum, tab){
            var str = "";
            if(task.status == false){
                str =  str + '\n' + "<div name=\"" + rowNum + "\" id=\"" + rowNum + "\">" + tab + task.id + " " + task.name +"&emsp;" +  "</div>";
            }else{
                str =  str + '\n' + "<div name=\"" + rowNum + "\" id=\"" + rowNum + "\">" + tab + task.id + " " + task.name + "&emsp;" + checkMark + "</div>";
            }
            return str;
        }

        



        function updateTeammateSelectOptions(teammates){
            // <option value="volvo">Volvo</option>
            var str = "";
            teammates.forEach(teammate => {
                // console.log(teammate.name);
                str = str + '\n' + "<option value=\"" + teammate.name + "\">" + teammate.name + "</option>";
                // console.log(str);
            });
            document.getElementById("ProjectViewTeammateInput").innerHTML = str;
        }



        function generateProjectViewText(tasks){
            var str = "";
            rowNum = 1;
            var tab = "&emsp;&emsp;";
            try{
                tasks.forEach(task => {
                    str = str + generateTaskString(task, rowNum,"");
                    rowNum = rowNum + 1;
                    
                    var assignees = task["assignedTeammates"]
                    if (assignees != undefined){
                        assignees.forEach (assignee => {
                            str = str + '\n' + "<div>" + tab + assignee + "</div>";
                        });  
                    }

                });
            }catch{
                str = "No tasks exist for this project";
            }
            // console.log(str);
            projectViewDisplayData = str;

            // document.getElementById("AdminProjectDisplayBox").innerHTML = str;
            // writeToDisplayBox(str);
            // updateHighlightedRow();
        }

        function generateTeamViewText(teammates){
            var str = "";
            rowNum = 1;
            var tab = "&emsp;&emsp;";
            try{
                teammates.forEach(teammate => {
                    str =  str + '\n' + "<div name=\"" + rowNum + "\" id=\"" + rowNum + "\">" + teammate.name + "</div>";
                    rowNum = rowNum + 1
                    
                    var tasks = teammate["taskList"]
                    if (tasks != undefined){
                        tasks.forEach (task => {
                            if(task.status == false){
                                str =  str + '\n' + "<div>" + tab + task.id + " " + task.name + "</div>";
                            }else{
                                str =  str + '\n' + "<div>" + tab + task.id + " " + task.name + "&emsp;" + checkMark +"</div>";
                            }
                        });
                    }
                });    
            }catch{
                str = "No teammates exist for this project";
            }
            // console.log(str);
            teamViewDisplayData = str;

            // document.getElementById("AdminProjectDisplayBox").innerHTML = str;
            // writeToDisplayBox(str);
            // updateHighlightedRow();
        }

        

        //Runs when the create project button is pressed
        //Adds project to database, and prints to screen when successful
        function createProjectButtonPress(){
            var form = document.testForm;
            var textVal = form.textBox.value;

            var data = {};
            data["projectName"] = textVal;


            var js = JSON.stringify(data);
            console.log("JS:" + js);
            var xhr = new XMLHttpRequest();
            xhr.open("POST", createProjectURL, true);

            //Send the data as JSON
            xhr.send(js);

            document.getElementById("LandingPageNotification").innerHTML = "Working on creating project...";

            //Process result
            xhr.onloadend = function (){
                console.log(xhr);
                console.log(xhr.request);
                if (xhr.readyState == XMLHttpRequest.DONE){
                    if(xhr.status == 200){
                        console.log("XHR:" + xhr.responseText);
                        processCreateProjectResponse(xhr.responseText);
                    }else if(xhr.status == 400){
                        alert("Unable to process request");
                    }
                }else{
                    processCreateProjectResponse("N/A");
                }
            };
            // form.CreateProjectButton.value = textVal;
            // document.getElementById("LandingPageNotification").innerHTML = "Create Project Button Pressed";
        }

        //Print the created project name to screen
        function processCreateProjectResponse(result){
            console.log("result:" + result);
            var js = JSON.parse(result);
            if(result != "N/A"){
                document.getElementById("LandingPageNotification").innerHTML = "Successfully created project: " + js["projectName"];
            }else{
                document.getElementById("LandingPageNotification").innerHTML = "Could not create project";
            }
        }
        // USER PAGE FUNCTIONS ---------------------------------------------------------------------


        //Hides Team view tab and shows project view tab
        function changeToProjectViewButtonPress(){
            document.getElementById ("TeamView").hidden = true;
            document.getElementById ("ProjectView").hidden = false;
            writeToDisplayBox(projectViewDisplayData);
            updateHighlightedRow();
        }

        //Hides project view tab and shows team view
        function changeToTeamViewButtonPress(){
            document.getElementById ("ProjectView").hidden = true;
            document.getElementById ("TeamView").hidden = false;
            writeToDisplayBox(teamViewDisplayData);
            updateHighlightedRow();
        }

        function addTaskButtonPress(){
            var taskName = document.getElementById("ProjectViewTaskInput").value;
            var projectName = document.testForm.textBox.value;

            var task = {};
            task["name"] = taskName;

            //Determine the next top level task number available
            var idNum = 1;
            var newIDNum = 1;

            while(document.getElementById(idNum) != null){
                if(document.getElementById(idNum).innerHTML.charCodeAt(0) != 8195 && document.getElementById(idNum).innerHTML.indexOf(".") == -1){
                    newIDNum = newIDNum + 1;
                }
                idNum = idNum + 1;
            }

            task["id"] = newIDNum ;

            var project = {};
            project["name"] = projectName;

            var data = {};
            data["task"] = task;
            data["project"] = project;


            var js = JSON.stringify(data);
            console.log("JS:" + js);
            var xhr = new XMLHttpRequest();
            xhr.open("POST", addTaskURL, true);

            //Send the data as JSON
            xhr.send(js);

            document.getElementById("ProjectViewNotification").innerHTML = "Working on adding task...";

            //Process result
            xhr.onloadend = function (){
                console.log(xhr);
                console.log(xhr.request);
                if (xhr.readyState == XMLHttpRequest.DONE){
                    if(xhr.status == 200){
                        console.log("XHR:" + xhr.responseText);
                        processAddTaskResponse(xhr.responseText);
                    }else if(xhr.status == 400){
                        alert("Unable to process request");
                    }
                }else{
                    processAddTaskResponse("N/A");
                }
            };
        }


        


        // Handler for marking a task as complete
        function MarkSelectedTaskButtonPress(){
            var form = document.testForm;
            var textVal = form.textBox.value;

            //Remove the id # and checkmark from the task name
            var taskName = document.getElementById(highlightedRow).innerHTML;
            var markingComplete = true;

            if(taskName.indexOf(checkMark) == -1){
                taskName = taskName.substring(taskName.indexOf(" ") + 1,taskName.length-1);
            }else{
                taskName = taskName.substring(taskName.indexOf(" ") + 1,taskName.length-2);
                markingComplete = false;
            }
            

            var data = {};
            data["projectName"] = textVal;
            data["taskName"] = taskName;


            var js = JSON.stringify(data);
            console.log("JS:" + js);
            var xhr = new XMLHttpRequest();
            xhr.open("POST", markTaskCompletedURL, true);

            if(markingComplete){
                document.getElementById("ProjectViewNotification").innerHTML = "Marking task: " + taskName + " as complete";
            }else{
                document.getElementById("ProjectViewNotification").innerHTML = "Marking task: " + taskName + " as incomplete";    
            }

            //Send the data as JSON
            xhr.send(js);

            //Process result
            xhr.onloadend = function (){
                console.log(xhr);
                console.log(xhr.request);
                if (xhr.readyState == XMLHttpRequest.DONE){
                    if(xhr.status == 200){
                        console.log("XHR:" + xhr.responseText);
                        processMarkTaskCompleteResponse(xhr.responseText);
                    }else if(xhr.status == 400){
                        alert("Unable to process request");
                    }
                }else{
                    processMarkTaskCompleteResponse("N/A");
                }
            };
        }

        function processMarkTaskCompleteResponse(result){
            console.log("result:" + result);
            var js = JSON.parse(result);
            
            //If the task did not have the checkmark before being marked, it is marked as complete. Otherwise marked as incomplete.
            var taskName = document.getElementById(highlightedRow).innerHTML;
            
            if(taskName.indexOf(checkMark) == -1){
                taskStatus = "complete";
            }else{
                taskStatus = "incomplete"
            }

            if(result == "N/A"){
                document.getElementById("ProjectViewNotification").innerHTML = "Could not change task marking for: " + js.taskName;
                return;
            }
            document.getElementById("ProjectViewNotification").innerHTML = "Marked task: " + js.taskName + " as " + taskStatus;
            openProject();
        }


        function processAddTaskResponse(result){
            console.log("result:" + result);
            var js = JSON.parse(result);
            if(result != "N/A"){
                document.getElementById("ProjectViewNotification").innerHTML = "Successfully created task: " + js["taskName"];
                
                //Used to update the view
                openProject();
            }else{
                document.getElementById("LandingPageNotification").innerHTML = "Could not create project";
            }

            
        }

        function addTeammateButtonPress(){
            var teammateName = document.getElementById("teammateTextBox").value;

            var projectName = document.testForm.textBox.value;

            var data = {};
            data["teammateName"] = teammateName;
            data["projectName"] = projectName;

            var js = JSON.stringify(data);
            console.log("JS:" + js);
            var xhr = new XMLHttpRequest();
            xhr.open("POST", addTeammateURL, true);

            //Send the data as JSON
            xhr.send(js);

            document.getElementById("TeamViewNotification").innerHTML = "Working on adding teammate...";

            //Process result
            xhr.onloadend = function (){
                console.log(xhr);
                console.log(xhr.request);
                if (xhr.readyState == XMLHttpRequest.DONE){
                    if(xhr.status == 200){
                        console.log("XHR:" + xhr.responseText);
                        processAddTeammateResponse(xhr.responseText);
                    }else if(xhr.status == 400){
                        alert("Unable to process request");
                    }
                }else{
                    processAddTeammateResponse("N/A");
                }
            };
        }

        function processAddTeammateResponse(result){
            var js = JSON.parse(result);
            errorMsg = js["error"];
            
            //If teammate didnt already exist, add them, otherwise display error to screen
            if(errorMsg == ""){
                document.getElementById("TeamViewNotification").innerHTML = "Successfully added teammate.";
                openProject();
            }else{
                document.getElementById("TeamViewNotification").innerHTML = errorMsg;
            }
        }



        function removeTeammateButtonPress(){
            console.log("Removing Teammate");
            var teammateName = document.getElementById(highlightedRow).innerHTML;
            
            var projectName = document.testForm.textBox.value;
            //Remove tabs here if necessary

            var data = {};
            data["teammateName"] = teammateName;
            data["projectName"] = projectName;


            var js = JSON.stringify(data);
            console.log("JS:" + js);
            var xhr = new XMLHttpRequest();
            xhr.open("POST", removeTeammateURL, true);

            //Send the data as JSON
            xhr.send(js);

            document.getElementById("TeamViewNotification").innerHTML = "Working on removing teammate...";

            //Process result
            xhr.onloadend = function (){
                console.log(xhr);
                console.log(xhr.request);
                if (xhr.readyState == XMLHttpRequest.DONE){
                    if(xhr.status == 200){
                        console.log("XHR:" + xhr.responseText);
                        processRemoveTeammateResponse(xhr.responseText);
                    }else if(xhr.status == 400){
                        alert("Unable to process request");
                    }
                }else{
                    processRemoveTeammateResponse("N/A");
                }
            };
        }

        //Print the created project name to screen
        function processRemoveTeammateResponse(result){
            openProject();
            document.getElementById("TeamViewNotification").innerHTML = "Successfully removed teammate...";
        }


        function AssignTeammateButtonPress(){

            var taskName = document.getElementById(highlightedRow).innerHTML;

            var taskID = taskName.substring(0,taskName.indexOf(" "));

            var teammateName = document.getElementById("ProjectViewTeammateInput").value;

            var projectName = document.testForm.textBox.value;

            var data = {};
            data["idProject"] = projectName;
            data["teammateName"] = teammateName;
            data["idTask"] = taskID;


            var js = JSON.stringify(data);
            console.log("JS:" + js);
            var xhr = new XMLHttpRequest();
            xhr.open("POST", assignTeammateURL, true);

            
            document.getElementById("ProjectViewNotification").innerHTML = "Assigning Teammate: " + teammateName + " to task# " + taskID + ".";
            

            //Send the data as JSON
            xhr.send(js);

            //Process result
            xhr.onloadend = function (){
                console.log(xhr);
                console.log(xhr.request);
                if (xhr.readyState == XMLHttpRequest.DONE){
                    if(xhr.status == 200){
                        console.log("XHR:" + xhr.responseText);
                        processAssignTeammateResponse(xhr.responseText);
                    }else if(xhr.status == 400){
                        alert("Unable to process request");
                    }
                }else{
                    processAssignTeammateResponse("N/A");
                }
            };
        }

        
        function processAssignTeammateResponse(result){
            var js = JSON.parse(result);
            

            errorMsg = js["error"];
            
            //If teammate didnt already exist, add them, otherwise display error to screen
            if(errorMsg == ""){
                openProject();
                document.getElementById("ProjectViewNotification").innerHTML = "Successfully assigned teammate.";
            }else{
                document.getElementById("ProjectViewNotification").innerHTML = errorMsg;
            }

        }


        function UnassignTeammateButtonPress(){

            var taskName = document.getElementById(highlightedRow).innerHTML;

            var taskID = taskName.substring(0,taskName.indexOf(" "));

            var teammateName = document.getElementById("ProjectViewTeammateInput").value;

            var projectName = document.testForm.textBox.value;

            var data = {};
            data["idProject"] = projectName;
            data["teammateName"] = teammateName;
            data["idTask"] = taskID;


            var js = JSON.stringify(data);
            console.log("JS:" + js);
            var xhr = new XMLHttpRequest();
            xhr.open("POST", unassignTeammateURL, true);


            document.getElementById("ProjectViewNotification").innerHTML = "Unassigning Teammate: " + teammateName + " from task# " + taskID + ".";


            //Send the data as JSON
            xhr.send(js);

            //Process result
            xhr.onloadend = function (){
                console.log(xhr);
                console.log(xhr.request);
                if (xhr.readyState == XMLHttpRequest.DONE){
                    if(xhr.status == 200){
                        console.log("XHR:" + xhr.responseText);
                        processUnassignTeammateResponse(xhr.responseText);
                    }else if(xhr.status == 400){
                        alert("Unable to process request");
                    }
                }else{
                    processUnassignTeammateResponse("N/A");
                }
            };
            }


        function processUnassignTeammateResponse(result){
            var js = JSON.parse(result);

            errorMsg = js["error"];

            //If teammate didnt already exist, add them, otherwise display error to screen
            if(errorMsg == ""){
                openProject();
                document.getElementById("ProjectViewNotification").innerHTML = "Successfully unassigned teammate.";
            }else{
                document.getElementById("ProjectViewNotification").innerHTML = errorMsg;
            }

        }


        
        function addSubtaskButtonPress(){

            var parentTaskName = document.getElementById(highlightedRow).innerHTML;

            var parentTaskID = parentTaskName.substring(0,parentTaskName.indexOf(" "));

            //Determine next task number for the new subdivided task

            var newTaskNumNotFound = true;
            var divNum = highlightedRow;
            while(document.getElementById(divNum).innerHTML.indexOf(parentTaskID) != -1){
                divNum = divNum + 1;
            }
            //element ID of last row with that parent ID
            divNum = divNum - 1;

            //if the highlighted row is the last instance of this parentID, then the next value is ParentID + ".1"
            if(divNum == highlightedRow){
                var childTaskNum = parentTaskID + ".1";
            }else{
                //Get the last task with that parent task number
                var childTaskNum = document.getElementById(divNum).innerHTML;

                //Remove everything after the task ID number, and everything that is the parent task ID
                childTaskNum = childTaskNum.substring(parentTaskID.length + 1,childTaskNum.indexOf(" "));
                
                //If there are multiple subdivisions, then remove after the first set of subdivisions
                if(childTaskNum.indexOf(".") == -1){
                    childTaskNum = parseInt(childTaskNum) + 1; //Add one since this is the value of the last existing task
                }else{
                    childTaskNum = childTaskNum.substring(0,childTaskNum.indexOf("."));
                    childTaskNum = parseInt(childTaskNum) + 1;
                }

                childTaskNum = parentTaskID + "." + childTaskNum.toString();
            }


            var childTaskName = document.getElementById("ProjectViewTaskInput").value;

            var projectName = document.testForm.textBox.value;

            var project = {};
            project["name"] = projectName;

            var task = {};
            task["name"] = childTaskName;
            task["idParent"] = parentTaskID;
            task["idProject"] = projectName;
            task["id"] = childTaskNum

            var data = {};
            data["project"] = project;
            data["task"] = task;


            var js = JSON.stringify(data);
            console.log("JS:" + js);
            var xhr = new XMLHttpRequest();
            xhr.open("POST", subdivideTaskURL, true);


            document.getElementById("ProjectViewNotification").innerHTML = "Subdividing task: " + parentTaskID;


            //Send the data as JSON
            xhr.send(js);

            //Process result
            xhr.onloadend = function (){
                console.log(xhr);
                console.log(xhr.request);
                if (xhr.readyState == XMLHttpRequest.DONE){
                    if(xhr.status == 200){
                        console.log("XHR:" + xhr.responseText);
                        processSubdivideTaskResponse(xhr.responseText);
                    }else if(xhr.status == 400){
                        alert("Unable to process request");
                    }
                }else{
                    processSubdivideTaskResponse("N/A");
                }
            };
            }


        function processSubdivideTaskResponse(result){
            var js = JSON.parse(result);

            errorMsg = js["error"];

            //If teammate didnt already exist, add them, otherwise display error to screen
            if(errorMsg == ""){
                document.getElementById("ProjectViewNotification").innerHTML = "Successfully subdivided task.";
                openProject();
            }else{
                document.getElementById("ProjectViewNotification").innerHTML = errorMsg;
            }

            }
            


    </script>

<!-- ---------------------------------------------------------------------- -->
<!-- LANDING PAGE -->
<div class="centered" id="LandingPage">    
    <br style="line-height: 70px;">
    <header style="font-size: 50px; font-family: Arial, Helvetica, sans-serif; font-weight: 500;">
        Sis Fortis Project Management
    </header>

    <br>

    <form name="testForm" method="post">
        <input type="text" value="" id="textBox" style="font-size: 18px;">
        <input type="button" class="button" value="Administrator" id="AdminButton"  onclick="JavaScript:adminButtonPress(this)">
        <input type="button" class="button" value="Open Project" id="OpenProjectButton"  onclick="JavaScript:openProjectButtonPress(this)">
        <input type="button" class="button" value="Create Project" id="CreateProjectButton"  onclick="JavaScript:createProjectButtonPress(this)">
        
    </form>

    <br style="line-height: 70px;">
    <p id="LandingPageNotification">
        
    </p>
</div>


<!-- ---------------------------------------------------------------------- -->
<!-- ADMIN PAGE -->

<div id="AdminPage" hidden>
    <div class="split left">
        <div class="centered">
            <br style="line-height: 30px;"> 
            <header id="AdminHeader"  class="header">
                Administator View
            </header>
            <br>
        </div>
        
    
        <div class="box centered">
            <div class="outline" id="AdminProjectDisplayBox" name="AdminProjectDisplayBox">
                <b>
                <!-- <div id="1">1 Task 1</div>
                <div id="2">&emsp;&emsp;1.1 Task 1.1</div>
                <div id="3">&emsp;&emsp;1.2 Task 1.2</div>
                <div id="4">&emsp;&emsp;1.3 Task 1.3</div>
                <div id="5">&emsp;&emsp;&emsp;&emsp;1.3.1 Task 1.3.1</div>
                <div id="6">&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;1.3.1.1 Task 1.3.1.1</div>
                <div id="7">&emsp;&emsp;&emsp;&emsp;1.3.2 Task 1.3.2</div>
                <div id="8">&emsp;&emsp;&emsp;&emsp;1.3.3 Task 1.3.3</div>
                <div id="9">&emsp;&emsp;1.4 Task 1.4</div>
                <div id="10">2 Task 2</div>
                <div id="11">&emsp;&emsp;2.1 Task 2.1</div>
                <div id="12">&emsp;&emsp;2.2 Task 2.2</div>
                <div id="13">&emsp;&emsp;&emsp;&emsp;2.2.1 Task 2.2.1</div>
                <div id="14">&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;2.2.1.1 Task 2.2.1.1</div>
                <div id="15">&emsp;&emsp;2.3 Task 2.3</div>
                <div id="16">&emsp;&emsp;2.4 Task 2.4</div>
                <div id="17">3 Task 3</div> -->
                </b>
            </div>
        </div>

    </div>

    <div class="split right">
    <div class="centered">        
        <br style="line-height: 30px;"> 
        <header id="AdminToolsHeader"  class="header">
            Project Selection Tools
        </header>

        <br style="line-height: 30px;">
        <div>
            <button class="arrowButton" id="UpArrowButton" onclick="JavaScript:upArrowButtonPress()">&#11165;</button>
        </div>
        <br>
        <div>
            <button class="arrowButton" id="DownArrowButton" onclick="JavaScript:downArrowButtonPress()">&#11167;</button>
        </div>
        <!-- &#x21e7; &#x21e9; these are a different style of arrows -->

        <br style="line-height: 80px;">
        <form name="ArchiveProjectForm" method="post"> 
            <input type="button" value="Archive Project" class="button" id="ArchiveProjectButton" onclick="JavaScript:archiveProjectButtonPress()"></button>
        </form>

        <br style="line-height: 20px;">
        <form name="DeleteProjectForm" method="post" >
            <input type="button" value="Delete Project" class="button" id="DeleteProjectButton" onclick="JavaScript:deleteProjectButtonPress()"></button>
        </form>


        <br style="line-height: 80px;">
        <p id="AdminPageNotification"></p>

    </div>
    </div>
</div>

<!-- ------------------------------------------------------------------------- -->
<!-- USER PAGE -->
<div id="UserPage" hidden>
    <!-- TEAM VIEW -->
    <div id="TeamView">
        <div class="split left" id="leftColumn">
            <div class="centered">
                <br style="line-height: 30px;"> 
                <header id="ProjectNameHeader"  class="header">
                    
                </header>
                <br>
            </div>
            
        
            <div class="box centered">
                <div class="outline" id="AdminProjectDisplayBox" name="AdminProjectDisplayBox">
                    <b>
                    <!-- <div id="1">1 Task 1</div>
                    <div id="2">&emsp;&emsp;1.1 Task 1.1</div>
                    <div id="3">&emsp;&emsp;1.2 Task 1.2</div>
                    <div id="4">&emsp;&emsp;1.3 Task 1.3</div>
                    <div id="5">&emsp;&emsp;&emsp;&emsp;1.3.1 Task 1.3.1</div>
                    <div id="6">&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;1.3.1.1 Task 1.3.1.1</div>
                    <div id="7">&emsp;&emsp;&emsp;&emsp;1.3.2 Task 1.3.2</div>
                    <div id="8">&emsp;&emsp;&emsp;&emsp;1.3.3 Task 1.3.3</div>
                    <div id="9">&emsp;&emsp;1.4 Task 1.4</div>
                    <div id="10">2 Task 2</div>
                    <div id="11">&emsp;&emsp;2.1 Task 2.1</div>
                    <div id="12">&emsp;&emsp;2.2 Task 2.2</div>
                    <div id="13">&emsp;&emsp;&emsp;&emsp;2.2.1 Task 2.2.1</div>
                    <div id="14">&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;2.2.1.1 Task 2.2.1.1</div>
                    <div id="15">&emsp;&emsp;2.3 Task 2.3</div>
                    <div id="16">&emsp;&emsp;2.4 Task 2.4</div>
                    <div id="17">3 Task 3</div> -->
                    </b>
                </div>
            </div>

        </div>

        <div class="split right">
            <div class="centered">        
                <br style="line-height: 30px;"> 
                <header id="UserPageToolsHeader"  class="header">
                    Project Tools
                </header>

                <br style="line-height: 30px;">
                <div>
                    <button class="arrowButton" id="UpArrowButton" onclick="JavaScript:upArrowButtonPress()">&#11165;</button>
                </div>
                <br>
                <div>
                    <button class="arrowButton" id="DownArrowButton" onclick="JavaScript:downArrowButtonPress()">&#11167;</button>
                </div>
                <!-- &#x21e7; &#x21e9; these are a different style of arrows -->



                <br style="line-height: 80px;">
                <form name="TeammateTextBoxForm" method="post">
                    <input type="text" value="" class="textBox" id="teammateTextBox">
                </form>
                
                
                <form name="AddTeammateForm" method="post"> 
                    <input type="button" value="Add Teammate to Project" class="button" id="AddTeammateButton" onclick="JavaScript:addTeammateButtonPress()"></button>
                </form>

                <form name="RemoveTeammateForm" method="post" >
                    <input type="button" value="Remove Selected Teammate" class="button" id="RemoveTeammateButton" onclick="JavaScript:removeTeammateButtonPress()"></button>
                </form>

                <br style="line-height: 80px;">


                <form name="ChangeToProjectViewForm" method="post" >
                    <input type="button" value="Switch to Project View" class="button" id="ProjectViewButton" onclick="JavaScript:changeToProjectViewButtonPress()"></button>
                </form>

                <br style="line-height: 80px;">
                <p id="TeamViewNotification"></p>

            </div>
        </div>
    </div>

    <!-- PROJECT VIEW -->
    <div id="ProjectView" hidden>
        <div class="split left" id="leftColumn">
            <div class="centered">
                <br style="line-height: 30px;"> 
                <header id="ProjectViewHeader"  class="header">
                    
                </header>
                <br>
            </div>
            
        
            <div class="box centered">
                <div class="outline" id="outlineBox" name="AdminProjectDisplayBox">
                    <b>
                        <div>test </div>
                    <!-- <div id="1">1 Task 1</div>
                    <div id="2">&emsp;&emsp;1.1 Task 1.1</div>
                    <div id="3">&emsp;&emsp;1.2 Task 1.2</div>
                    <div id="4">&emsp;&emsp;1.3 Task 1.3</div>
                    <div id="5">&emsp;&emsp;&emsp;&emsp;1.3.1 Task 1.3.1</div>
                    <div id="6">&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;1.3.1.1 Task 1.3.1.1</div>
                    <div id="7">&emsp;&emsp;&emsp;&emsp;1.3.2 Task 1.3.2</div>
                    <div id="8">&emsp;&emsp;&emsp;&emsp;1.3.3 Task 1.3.3</div>
                    <div id="9">&emsp;&emsp;1.4 Task 1.4</div>
                    <div id="10">2 Task 2</div>
                    <div id="11">&emsp;&emsp;2.1 Task 2.1</div>
                    <div id="12">&emsp;&emsp;2.2 Task 2.2</div>
                    <div id="13">&emsp;&emsp;&emsp;&emsp;2.2.1 Task 2.2.1</div>
                    <div id="14">&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;2.2.1.1 Task 2.2.1.1</div>
                    <div id="15">&emsp;&emsp;2.3 Task 2.3</div>
                    <div id="16">&emsp;&emsp;2.4 Task 2.4</div>
                    <div id="17">3 Task 3</div> -->
                    </b>
                </div>
            </div>

        </div>

        <div class="split right">
            <div class="centered">        
                <br style="line-height: 30px;"> 
                <header id="UserPageToolsHeader"  class="header">
                    Project Tools
                </header>

                <br style="line-height: 30px;">
                <div>
                    <button class="arrowButton" id="UpArrowButton" onclick="JavaScript:upArrowButtonPress()">&#11165;</button>
                </div>
                <br>
                <div>
                    <button class="arrowButton" id="DownArrowButton" onclick="JavaScript:downArrowButtonPress()">&#11167;</button>
                </div>
                <!-- &#x21e7; &#x21e9; these are a different style of arrows -->



                <br style="line-height:  40px;">
                <form name="TextBoxForm" method="post">
                    <input type="text" value="" class="textBox" id="ProjectViewTaskInput">
                </form>
                
                
                <form name="AddTaskForm" method="post"> 
                    <input type="button" value="Add New Task(s)" class="button" id="AddTaskButton" onclick="JavaScript:addTaskButtonPress()"></button>
                </form>

                <form name="AddNewSubTasks" method="post" >
                    <input type="button" value="Add New Subtask(s)" class="button" id="AddSubtaskButton" onclick="JavaScript:addSubtaskButtonPress()"></button>
                </form>
                
                <br style="line-height: 30px;">
                
                
                <form name="TextBoxForm" method="post">
                    <!-- <input type="text" value="" class="textBox" id="ProjectViewTeammateInput"> -->
                    <select name="ProjectViewTeammateInput" id="ProjectViewTeammateInput">
                        <!-- Use document.getElementById("ProjectViewTeammateInput").value to get selected value. -->
                        <!-- <option value="volvo">Volvo</option>
                        <option value="saab">Saab</option>
                        <option value="mercedes">Mercedes</option>
                        <option value="audi">Audi</option> -->
                    </select>

                </form>
                
                
                <form name="AssignTeammateForm" method="post"> 
                    <input type="button" value="Assign Teammate(s) To Task" class="button" id="AssignTeammateButton" onclick="JavaScript:AssignTeammateButtonPress()"></button>
                </form>

                <form name="UnassignTeammate" method="post" >
                    <input type="button" value="Unassign Selected Teammate" class="button" id="UnassignTeammateButton" onclick="JavaScript:UnassignTeammateButtonPress()"></button>
                </form>

                <br style="line-height: 30px;">

                <form name="MarkTaskCompleteForm" method="post" >
                    <input type="button" value="Mark Selected Task Complete" class="button" id="MarkSelectedTaskButton" onclick="JavaScript:MarkSelectedTaskButtonPress()"></button>
                </form>



                <br style="line-height: 30px;">


                <form name="ChangeToTeamViewForm" method="post" >
                    <input type="button" value="Switch to Team View" class="button" id="TeamViewButton" onclick="JavaScript:changeToTeamViewButtonPress()"></button>
                </form>

                <br style="line-height: 30px;">
                <p id="ProjectViewNotification"></p>

            </div>
        </div>
    </div>
</div>

</html>